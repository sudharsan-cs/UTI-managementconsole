const { log } = require("console");
const PATH = require("path");
var malwareModelObj = require(PATH.join(
  __dirname,
  "mongo-models",
  "malware-info-model"
));

var getMalwareInfo = async function (start, limit, malwareQuery) {
  try {
    var query = {};
    if (malwareQuery) {
      query = {
        $or: [
          { first_seen: { $regex: malwareQuery} },
          { last_seen: { $regex: malwareQuery} },
          { file_name: { $regex: malwareQuery}},
          { file_type: { $regex: malwareQuery }},
          { sha256_hash: { $regex: malwareQuery }},
          { sha3_384_hash: { $regex: malwareQuery }},
          { sha1_hash: { $regex: malwareQuery }},
          { md5_hash: { $regex: malwareQuery }}
        ],
      };
    };
    return await malwareModelObj
      .find(query)
      .sort({ first_seen: -1 })
      .select("sha256_hash sha3_384_hash sha1_hash md5_hash file_name file_type file_size first_seen last_seen tags intelligence signature reporter")
      .skip(start)
      .limit(limit)
      .then((data) => {
        return data;
      })
      .catch((error) => {
        console.log(error);
        return false;
      });
  } catch (error) {
    console.log(error);
  }
};

module.exports = {
  getMalwareInfo
};
